var be=Object.defineProperty,fe=Object.defineProperties;var pe=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var ke=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable;var S=(s,e,r)=>e in s?be(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r,h=(s,e)=>{for(var r in e||(e={}))ke.call(e,r)&&S(s,r,e[r]);if(C)for(var r of C(e))Be.call(e,r)&&S(s,r,e[r]);return s},m=(s,e)=>fe(s,pe(e));(function(s,e){typeof exports=="object"&&typeof module!="undefined"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(s=typeof globalThis!="undefined"?globalThis:s||self,e(s.Buche={},s.Vue))})(this,function(s,e){"use strict";var r,D=new Uint8Array(16);function x(){if(!r&&(r=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!r))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(D)}var T=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function U(n){return typeof n=="string"&&T.test(n)}for(var c=[],y=0;y<256;++y)c.push((y+256).toString(16).substr(1));function W(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(c[n[o+0]]+c[n[o+1]]+c[n[o+2]]+c[n[o+3]]+"-"+c[n[o+4]]+c[n[o+5]]+"-"+c[n[o+6]]+c[n[o+7]]+"-"+c[n[o+8]]+c[n[o+9]]+"-"+c[n[o+10]]+c[n[o+11]]+c[n[o+12]]+c[n[o+13]]+c[n[o+14]]+c[n[o+15]]).toLowerCase();if(!U(t))throw TypeError("Stringified UUID is invalid");return t}function w(n,o,t){n=n||{};var l=n.random||(n.rng||x)();if(l[6]=l[6]&15|64,l[8]=l[8]&63|128,o){t=t||0;for(var i=0;i<16;++i)o[t+i]=l[i];return o}return W(l)}const b=(n,o)=>n.uuid===o?n:(n.children||[]).reduce((t,l)=>t||b(l,o),null),f=n=>m(h({},n),{uuid:w(),children:(n.children||[]).map(o=>f(o))}),p=(n,o,t)=>n.uuid===t?m(h({},n),{children:[...n.children||[],o]}):m(h({},n),{children:(n.children||[]).map(l=>p(l,o,t))}),N=(n,o)=>m(h({},n),{children:n.children.filter(t=>t.uuid!==o).map(t=>N(t,o))}),R=(n,o,t)=>{const l=p(n,f(o),t);return N(l,o.uuid)};var k=(n,o)=>{for(const[t,l]of o)n[t]=l;return n};const A={name:"BucheBranch",props:{nodes:{type:Array,default:()=>[]},show_labels:{type:Boolean,default:!1},copy_candidate:{},teleport_candidate:{},path:{},depth:{},blocks:{},can_destroy:{}},beforeCreate:function(){this.$options.components={BucheNode:g}},methods:{handle_before(n){const o=this.nodes.findIndex(i=>i.uuid===n);if(o===0||!o)return;const t=[...this.nodes],l=t.splice(o,1)[0];t.splice(o-1,0,l),this.$emit("update:nodes",t)},handle_after(n){const o=this.nodes.findIndex(i=>i.uuid===n);if(o===this.nodes.length-1||!o&&o!==0)return;const t=[...this.nodes],l=t.splice(o,1)[0];t.splice(o+1,0,l),this.$emit("update:nodes",t)},handle_destroy(n){this.$emit("update:nodes",[...this.nodes].filter(o=>o.uuid!==n))},updateBranch(n,o){this.$emit("update:nodes",this.nodes.map(t=>t.uuid===n?o:t))}}},j={class:"BucheBranch"};function z(n,o,t,l,i,a){const u=e.resolveComponent("buche-node");return e.openBlock(),e.createElementBlock("div",j,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.nodes,(d,B)=>(e.openBlock(),e.createBlock(u,{node:d,depth:t.depth,index:B,total:t.nodes.length,copy_candidate:t.copy_candidate,teleport_candidate:t.teleport_candidate,path:[...t.path,d.type],blocks:t.blocks,show_labels:t.show_labels,can_destroy:t.can_destroy,onBefore:_=>a.handle_before(d.uuid),onAfter:_=>a.handle_after(d.uuid),onWant_teleport:o[0]||(o[0]=_=>n.$emit("want_teleport",_)),onDestroy:_=>a.handle_destroy(d.uuid),onWant_copy:o[1]||(o[1]=_=>n.$emit("want_copy",_)),onTeleport:o[2]||(o[2]=_=>n.$emit("teleport",_)),onCopy:o[3]||(o[3]=_=>n.$emit("copy",_)),"onUpdate:node":_=>a.updateBranch(d.uuid,_),key:d.uuid},null,8,["node","depth","index","total","copy_candidate","teleport_candidate","path","blocks","show_labels","can_destroy","onBefore","onAfter","onDestroy","onUpdate:node"]))),128))])}var I=k(A,[["render",z]]),we="";const L={components:{BucheBranch:I},name:"BucheNode",data(){return{show_actions:!1,show_adders:!1,folded:!1}},props:{node:{type:Object,required:!0},show_labels:{type:Boolean,default:!1},depth:{type:Number,default:0},blocks:{type:Object,default:()=>({})},path:{type:Array,default:()=>[]},index:{type:Number},total:{type:Number},copy_candidate:{},teleport_candidate:{},can_destroy:{type:Boolean,default:!0},root:{type:Boolean,default:!1}},methods:{find_block(n){return this.blocks[n]},update_nodes(n){this.$emit("update:node",m(h({},this.node),{children:n}))},add_child(n){this.$emit("update:node",m(h({},this.node),{children:[...this.node.children,n.constructor()]})),this.show_adders=!1}}},O={class:"BucheNode_header"},q={style:{display:"flex"}},F={key:0,class:"icon is-small"},G=[e.createElementVNode("i",{class:"mdi mdi-chevron-up"},null,-1)],M={key:1},P=[e.createElementVNode("i",{class:"mdi mdi-chevron-up mdi-rotate-180"},null,-1)],H=e.createTextVNode(" \xA0 "),X={key:0,class:"BucheNode_actions buttons"},J=["disabled"],K=[e.createElementVNode("span",{class:"icon is-small"},[e.createElementVNode("i",{class:"mdi mdi-arrow-up"})],-1)],Q=["disabled"],Y=[e.createElementVNode("span",{class:"icon is-small"},[e.createElementVNode("i",{class:"mdi mdi-arrow-down"})],-1)],Z=[e.createElementVNode("span",{class:"icon is-small"},[e.createElementVNode("i",{class:"mdi mdi-content-copy"})],-1)],v=[e.createElementVNode("span",{class:"icon is-small"},[e.createElementVNode("i",{class:"mdi mdi-target"})],-1)],$=["disabled"],ee=[e.createElementVNode("span",{class:"icon is-small"},[e.createElementVNode("i",{class:"mdi mdi-trash"})],-1)],te=[e.createElementVNode("span",{class:"icon is-small"},[e.createElementVNode("i",{class:"mdi mdi-close"})],-1)],oe=[e.createElementVNode("span",{class:"icon is-small"},[e.createElementVNode("i",{class:"mdi mdi-cog"})],-1)],ne={key:0,class:"BucheNode_editor"},de={key:1,class:"BucheNode_children"},ie={key:0,class:"BucheNode_children_empty"},le={key:1,class:"BucheNode_buttons_add_node",style:{"margin-top":"1em"}},se={class:"buttons",style:{"margin-top":"1em"}},ce=["onClick"],ae={key:2,class:"BucheNode_tree_actions_buttons buttons"};function re(n,o,t,l,i,a){const u=e.resolveComponent("buche-branch");return e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["BucheNode box",{[`BucheNode_node-${t.node.type}`]:1,"BucheNode--will_be_teleported":t.teleport_candidate===t.node.uuid,"BucheNode--will_be_copied":t.copy_candidate===t.node.uuid}]),style:e.normalizeStyle({background:`rgba(0,0,0, ${.03*(t.depth%4)})`})},[e.createElementVNode("div",O,[e.createElementVNode("div",q,[e.createElementVNode("button",{class:"button is-rounded is-small",onClick:o[0]||(o[0]=d=>i.folded=!i.folded)},[i.folded?(e.openBlock(),e.createElementBlock("span",F,G)):(e.openBlock(),e.createElementBlock("span",M,P))]),H,e.withDirectives(e.createElementVNode("h3",{class:"BucheNode_title subtitle"},e.toDisplayString(a.find_block(t.node.type).label),513),[[e.vShow,t.show_labels]])]),t.node.root?e.createCommentVNode("",!0):e.withDirectives((e.openBlock(),e.createElementBlock("div",X,[e.withDirectives(e.createElementVNode("button",{class:"BucheNode_action_reorder_prev button is-small is-rounded",disabled:t.index&&t.index===0,onClick:o[1]||(o[1]=d=>n.$emit("before",t.node.uuid))},K,8,J),[[e.vShow,i.show_actions]]),e.withDirectives(e.createElementVNode("button",{class:"BucheNode_action_reorder_next button is-small is-rounded",disabled:t.index&&t.index===t.total-1,onClick:o[2]||(o[2]=d=>n.$emit("after",t.node.uuid))},Y,8,Q),[[e.vShow,i.show_actions]]),e.withDirectives(e.createElementVNode("button",{class:e.normalizeClass(["BucheNode_action_reorder_copy button is-small is-rounded",t.copy_candidate===t.node.uuid?"is-primary":""]),onClick:o[3]||(o[3]=d=>n.$emit("copy",t.node.uuid))},Z,2),[[e.vShow,i.show_actions]]),e.withDirectives(e.createElementVNode("button",{class:e.normalizeClass(["BucheNode_action_reorder_teleport button is-small is-rounded",t.teleport_candidate===t.node.uuid?"is-primary":""]),onClick:o[4]||(o[4]=d=>n.$emit("teleport",t.node.uuid))},v,2),[[e.vShow,i.show_actions]]),e.withDirectives(e.createElementVNode("button",{class:"BucheNode_action_reorder_destroy button is-small is-rounded",disabled:!t.can_destroy,onClick:o[5]||(o[5]=d=>n.$emit("destroy"))},ee,8,$),[[e.vShow,i.show_actions]]),e.withDirectives(e.createElementVNode("button",{onClick:o[6]||(o[6]=d=>i.show_actions=0),class:"BucheNode_action_hide_actions button is-small is-rounded"},te,512),[[e.vShow,i.show_actions]]),e.withDirectives(e.createElementVNode("button",{onClick:o[7]||(o[7]=d=>i.show_actions=1),class:"BucheNode_action_hide_actions button is-small is-rounded"},oe,512),[[e.vShow,!i.show_actions]])],512)),[[e.vShow,!i.folded]])]),t.node.type!=="generic"?e.withDirectives((e.openBlock(),e.createElementBlock("div",ne,[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(a.find_block(t.node.type).editor),{value:t.node.data,"onUpdate:value":o[8]||(o[8]=d=>t.node.data=d)},null,8,["value"]))],512)),[[e.vShow,!i.folded]]):e.createCommentVNode("",!0),a.find_block(t.node.type).has_children?e.withDirectives((e.openBlock(),e.createElementBlock("div",de,[t.node.children.length===0?(e.openBlock(),e.createElementBlock("div",ie," No children yet. ")):e.createCommentVNode("",!0),e.createVNode(u,{nodes:t.node.children,path:[...t.path,t.node.type],blocks:t.blocks,can_destroy:!a.find_block(t.node.type).children_min||a.find_block(t.node.type).children_min<t.node.children.length,show_labels:t.show_labels,depth:t.depth+1,onCopy:o[9]||(o[9]=d=>n.$emit("copy",d)),onWant_teleport:o[10]||(o[10]=d=>n.$emit("want_teleport",d)),onTeleport:o[11]||(o[11]=d=>n.$emit("teleport",d)),onWant_copy:o[12]||(o[12]=d=>n.$emit("want_copy",d)),copy_candidate:t.copy_candidate,teleport_candidate:t.teleport_candidate,"onUpdate:nodes":a.update_nodes},null,8,["nodes","path","blocks","can_destroy","show_labels","depth","copy_candidate","teleport_candidate","onUpdate:nodes"]),!a.find_block(t.node.type).children_max||a.find_block(t.node.type).children_max>t.node.children.length?(e.openBlock(),e.createElementBlock("div",le,[e.createElementVNode("button",{class:"button is-small",onClick:o[13]||(o[13]=d=>i.show_adders=!i.show_adders)},e.toDisplayString(i.show_adders?"Close block list":"Add a block"),1),e.withDirectives(e.createElementVNode("div",se,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.blocks,(d,B)=>(e.openBlock(),e.createElementBlock("button",{class:e.normalizeClass(["button is-small",["BucheNode_button_add_block",`BucheNode_button_add_block-${d.type}`]]),key:B,onClick:_=>a.add_child(d)},e.toDisplayString(d.label),11,ce))),128))],512),[[e.vShow,i.show_adders]])])):e.createCommentVNode("",!0),t.teleport_candidate&&t.teleport_candidate!==t.node.uuid||t.copy_candidate&&t.copy_candidate!==t.node.uuid?(e.openBlock(),e.createElementBlock("div",ae,[t.teleport_candidate&&t.teleport_candidate!==t.node.uuid?(e.openBlock(),e.createElementBlock("button",{key:0,class:"button is-primary is-small",onClick:o[14]||(o[14]=d=>n.$emit("want_teleport",this.node.uuid))}," Teleport here. ")):e.createCommentVNode("",!0),t.copy_candidate&&t.copy_candidate!==t.node.uuid?(e.openBlock(),e.createElementBlock("button",{key:1,class:"button is-primary is-small",onClick:o[15]||(o[15]=d=>n.$emit("want_copy",this.node.uuid))}," Paste here. ")):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0)],512)),[[e.vShow,!i.folded]]):e.createCommentVNode("",!0)],6)}var g=k(L,[["render",re]]);const _e={name:"Buche",components:{BucheNode:g},props:{node:{},blocks:{},show_labels:{type:Boolean,default:!0}},data(){return{root_teleport_candidate:null,root_copy_candidate:null}},methods:{trigger_teleport(n){const o=this.root_teleport_candidate,t=b(this.node,o);this.$emit("update:node",R(this.node,t,n)),this.root_teleport_candidate=null},trigger_copy(n){const o=this.root_copy_candidate,t=b(this.node,o),l=f(t);this.$emit("update:node",p(this.node,l,n)),this.root_copy_candidate=null}}},he={class:"Buche box"};function me(n,o,t,l,i,a){const u=e.resolveComponent("buche-node");return e.openBlock(),e.createElementBlock("div",he,[t.node?(e.openBlock(),e.createBlock(u,{key:0,depth:0,index:0,total:1,root:!0,onWant_teleport:a.trigger_teleport,onWant_copy:a.trigger_copy,onTeleport:o[0]||(o[0]=d=>i.root_teleport_candidate=d===i.root_teleport_candidate?null:d),onCopy:o[1]||(o[1]=d=>i.root_copy_candidate=d===i.root_copy_candidate?null:d),blocks:t.blocks,path:[],show_labels:t.show_labels,copy_candidate:i.root_copy_candidate,teleport_candidate:i.root_teleport_candidate,node:t.node,"onUpdate:node":o[2]||(o[2]=d=>n.$emit("update:node",d))},null,8,["onWant_teleport","onWant_copy","blocks","show_labels","copy_candidate","teleport_candidate","node"])):e.createCommentVNode("",!0)])}var E=k(_e,[["render",me]]);const V={type:"generic",label:"Groupe",constructor:()=>({data:{},root:!1,type:"generic",children:[],uuid:w()}),children_min:0,has_children:!0},ue=()=>m(h({},V.constructor()),{root:!0}),ye=E;s.Buche=ye,s.default=E,s.generic_block=V,s.root_node=ue,Object.defineProperty(s,"__esModule",{value:!0}),s[Symbol.toStringTag]="Module"});
