var de=Object.defineProperty,ie=Object.defineProperties;var le=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var V=(c,e,a)=>e in c?de(c,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[e]=a,u=(c,e)=>{for(var a in e||(e={}))ce.call(e,a)&&V(c,a,e[a]);if(E)for(var a of E(e))re.call(e,a)&&V(c,a,e[a]);return c},h=(c,e)=>ie(c,le(e));(function(c,e){typeof exports=="object"&&typeof module!="undefined"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(c=typeof globalThis!="undefined"?globalThis:c||self,e(c.Buche={},c.Vue))})(this,function(c,e){"use strict";var a,S=new Uint8Array(16);function D(){if(!a&&(a=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!a))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(S)}var x=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function T(o){return typeof o=="string"&&x.test(o)}for(var r=[],y=0;y<256;++y)r.push((y+256).toString(16).substr(1));function U(o){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=(r[o[t+0]]+r[o[t+1]]+r[o[t+2]]+r[o[t+3]]+"-"+r[o[t+4]]+r[o[t+5]]+"-"+r[o[t+6]]+r[o[t+7]]+"-"+r[o[t+8]]+r[o[t+9]]+"-"+r[o[t+10]]+r[o[t+11]]+r[o[t+12]]+r[o[t+13]]+r[o[t+14]]+r[o[t+15]]).toLowerCase();if(!T(n))throw TypeError("Stringified UUID is invalid");return n}function N(o,t,n){o=o||{};var l=o.random||(o.rng||D)();if(l[6]=l[6]&15|64,l[8]=l[8]&63|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=l[i];return t}return U(l)}const f=(o,t)=>o.uuid===t?o:(o.children||[]).reduce((n,l)=>n||f(l,t),null),b=o=>h(u({},o),{uuid:N(),children:(o.children||[]).map(t=>b(t))}),p=(o,t,n)=>o.uuid===n?h(u({},o),{children:[...o.children||[],t]}):h(u({},o),{children:(o.children||[]).map(l=>p(l,t,n))}),g=(o,t)=>h(u({},o),{children:o.children.filter(n=>n.uuid!==t).map(n=>g(n,t))}),W=(o,t,n)=>{const l=p(o,b(t),n);return g(l,t.uuid)};var k=(o,t)=>{for(const[n,l]of t)o[n]=l;return o};const R={name:"BucheBranch",props:{nodes:{type:Array,default:()=>[]},copy_candidate:{},teleport_candidate:{},path:{},depth:{},blocks:{},can_destroy:{}},beforeCreate:function(){this.$options.components={BucheNode:w}},methods:{handle_before(o){const t=this.nodes.findIndex(i=>i.uuid===o);if(t===0||!t)return;const n=[...this.nodes],l=n.splice(t,1)[0];n.splice(t-1,0,l),this.$emit("update:nodes",n)},handle_after(o){const t=this.nodes.findIndex(i=>i.uuid===o);if(t===this.nodes.length-1||!t&&t!==0)return;const n=[...this.nodes],l=n.splice(t,1)[0];n.splice(t+1,0,l),this.$emit("update:nodes",n)},handle_destroy(o){this.$emit("update:nodes",[...this.nodes].filter(t=>t.uuid!==o))},updateBranch(o,t){this.$emit("update:nodes",this.nodes.map(n=>n.uuid===o?t:n))}}},z={class:"BucheBranch"};function j(o,t,n,l,i,s){const m=e.resolveComponent("buche-node");return e.openBlock(),e.createElementBlock("div",z,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.nodes,(d,B)=>(e.openBlock(),e.createBlock(m,{node:d,depth:n.depth,index:B,total:n.nodes.length,copy_candidate:n.copy_candidate,teleport_candidate:n.teleport_candidate,path:[...n.path,d.type],blocks:n.blocks,can_destroy:n.can_destroy,onBefore:_=>s.handle_before(d.uuid),onAfter:_=>s.handle_after(d.uuid),onWant_teleport:t[0]||(t[0]=_=>o.$emit("want_teleport",_)),onDestroy:_=>s.handle_destroy(d.uuid),onWant_copy:t[1]||(t[1]=_=>o.$emit("want_copy",_)),onTeleport:t[2]||(t[2]=_=>o.$emit("teleport",_)),onCopy:t[3]||(t[3]=_=>o.$emit("copy",_)),"onUpdate:node":_=>s.updateBranch(d.uuid,_),key:d.uuid},null,8,["node","depth","index","total","copy_candidate","teleport_candidate","path","blocks","can_destroy","onBefore","onAfter","onDestroy","onUpdate:node"]))),128))])}var A=k(R,[["render",j]]),se="";const I={components:{BucheBranch:A},name:"BucheNode",data(){return{show_actions:!1,show_adders:!1,folded:!1}},props:{node:{type:Object,required:!0},depth:{type:Number,default:0},blocks:{type:Object,default:()=>({})},path:{type:Array,default:()=>[]},index:{type:Number},total:{type:Number},copy_candidate:{},teleport_candidate:{},can_destroy:{type:Boolean,default:!0},root:{type:Boolean,default:!1}},methods:{find_block(o){return this.blocks[o]},update_nodes(o){this.$emit("update:node",h(u({},this.node),{children:o}))},add_child(o){this.$emit("update:node",h(u({},this.node),{children:[...this.node.children,o.constructor()]}))}}},L={class:"BucheNode_header"},O={style:{display:"flex"}},q=e.createTextVNode(" \xA0 "),F={class:"BucheNode_title subtitle"},G={key:0,class:"BucheNode_actions buttons"},M=["disabled"],P=["disabled"],H=["disabled"],X={key:0,class:"BucheNode_editor"},J={key:1,class:"BucheNode_children"},K={key:0,class:"BucheNode_children_empty"},Q={key:1,class:"BucheNode_buttons_add_node buttons"},Y=["onClick"],Z={class:"BucheNode_tree_actions_buttons buttons"};function v(o,t,n,l,i,s){const m=e.resolveComponent("buche-branch");return e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["BucheNode box",{[`BucheNode_node-${n.node.type}`]:1,"BucheNode--will_be_teleported":n.teleport_candidate===n.node.uuid,"BucheNode--will_be_copied":n.copy_candidate===n.node.uuid}]),style:e.normalizeStyle({background:`rgba(0,0,0, ${.03*(n.depth%4)})`})},[e.createElementVNode("div",L,[e.createElementVNode("div",O,[e.createElementVNode("button",{class:"button is-small",onClick:t[0]||(t[0]=d=>i.folded=!i.folded)},e.toDisplayString(i.folded?"unfold":"fold"),1),q,e.createElementVNode("h3",F,e.toDisplayString(s.find_block(n.node.type).label),1)]),n.node.root?e.createCommentVNode("",!0):e.withDirectives((e.openBlock(),e.createElementBlock("div",G,[e.withDirectives(e.createElementVNode("button",{class:"BucheNode_action_reorder_prev button is-small",disabled:n.index&&n.index===0,onClick:t[1]||(t[1]=d=>o.$emit("before",n.node.uuid))}," move before ",8,M),[[e.vShow,i.show_actions]]),e.withDirectives(e.createElementVNode("button",{class:"BucheNode_action_reorder_next button is-small",disabled:n.index&&n.index===n.total-1,onClick:t[2]||(t[2]=d=>o.$emit("after",n.node.uuid))}," move after ",8,P),[[e.vShow,i.show_actions]]),e.withDirectives(e.createElementVNode("button",{class:e.normalizeClass(["BucheNode_action_reorder_copy button is-small",n.copy_candidate===n.node.uuid?"is-primary":""]),onClick:t[3]||(t[3]=d=>o.$emit("copy",n.node.uuid))}," copy ",2),[[e.vShow,i.show_actions]]),e.withDirectives(e.createElementVNode("button",{class:e.normalizeClass(["BucheNode_action_reorder_teleport button is-small",n.teleport_candidate===n.node.uuid?"is-primary":""]),onClick:t[4]||(t[4]=d=>o.$emit("teleport",n.node.uuid))}," select for teleportation ",2),[[e.vShow,i.show_actions]]),e.withDirectives(e.createElementVNode("button",{class:"BucheNode_action_reorder_destroy button is-small",disabled:!n.can_destroy,onClick:t[5]||(t[5]=d=>o.$emit("destroy"))}," delete ",8,H),[[e.vShow,i.show_actions]]),e.withDirectives(e.createElementVNode("button",{onClick:t[6]||(t[6]=d=>i.show_actions=0),class:"BucheNode_action_hide_actions button is-small"}," \xD7 ",512),[[e.vShow,i.show_actions]]),e.withDirectives(e.createElementVNode("button",{onClick:t[7]||(t[7]=d=>i.show_actions=1),class:"BucheNode_action_hide_actions button is-small"}," actions ",512),[[e.vShow,!i.show_actions]])],512)),[[e.vShow,!i.folded]])]),n.node.type!=="generic"?e.withDirectives((e.openBlock(),e.createElementBlock("div",X,[(e.openBlock(),e.createBlock(e.resolveDynamicComponent(s.find_block(n.node.type).editor),{value:n.node.data,"onUpdate:value":t[8]||(t[8]=d=>n.node.data=d)},null,8,["value"]))],512)),[[e.vShow,!i.folded]]):e.createCommentVNode("",!0),s.find_block(n.node.type).has_children?e.withDirectives((e.openBlock(),e.createElementBlock("div",J,[n.node.children.length===0?(e.openBlock(),e.createElementBlock("div",K," No children yet. ")):e.createCommentVNode("",!0),e.createVNode(m,{nodes:n.node.children,path:[...n.path,n.node.type],blocks:n.blocks,can_destroy:!s.find_block(n.node.type).children_min||s.find_block(n.node.type).children_min<n.node.children.length,depth:n.depth+1,onCopy:t[9]||(t[9]=d=>o.$emit("copy",d)),onWant_teleport:t[10]||(t[10]=d=>o.$emit("want_teleport",d)),onTeleport:t[11]||(t[11]=d=>o.$emit("teleport",d)),onWant_copy:t[12]||(t[12]=d=>o.$emit("want_copy",d)),copy_candidate:n.copy_candidate,teleport_candidate:n.teleport_candidate,"onUpdate:nodes":s.update_nodes},null,8,["nodes","path","blocks","can_destroy","depth","copy_candidate","teleport_candidate","onUpdate:nodes"]),!s.find_block(n.node.type).children_max||s.find_block(n.node.type).children_max>n.node.children.length?(e.openBlock(),e.createElementBlock("div",Q,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.blocks,(d,B)=>(e.openBlock(),e.createElementBlock("button",{class:e.normalizeClass(["button is-small",["BucheNode_button_add_block",`BucheNode_button_add_block-${d.type}`]]),key:B,onClick:_=>s.add_child(d)}," + "+e.toDisplayString(d.label),11,Y))),128))])):e.createCommentVNode("",!0),e.createElementVNode("div",Z,[n.teleport_candidate&&n.teleport_candidate!==n.node.uuid?(e.openBlock(),e.createElementBlock("button",{key:0,class:"button is-primary is-small",onClick:t[13]||(t[13]=d=>o.$emit("want_teleport",this.node.uuid))}," Teleport here. ")):e.createCommentVNode("",!0),n.copy_candidate&&n.copy_candidate!==n.node.uuid?(e.openBlock(),e.createElementBlock("button",{key:1,class:"button is-primary is-small",onClick:t[14]||(t[14]=d=>o.$emit("want_copy",this.node.uuid))}," Paste here. ")):e.createCommentVNode("",!0)])],512)),[[e.vShow,!i.folded]]):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("span",{class:"BucheNode_uuid is-size-7"},e.toDisplayString(n.node.uuid.slice(0,8)),513),[[e.vShow,!i.folded]])],6)}var w=k(I,[["render",v]]);const $={name:"Buche",components:{BucheNode:w},props:{node:{},blocks:{}},data(){return{root_teleport_candidate:null,root_copy_candidate:null}},methods:{trigger_teleport(o){const t=this.root_teleport_candidate,n=f(this.node,t);this.$emit("update:node",W(this.node,n,o)),this.root_teleport_candidate=null},trigger_copy(o){const t=this.root_copy_candidate,n=f(this.node,t),l=b(n);this.$emit("update:node",p(this.node,l,o)),this.root_copy_candidate=null}}},ee={class:"Buche box"};function te(o,t,n,l,i,s){const m=e.resolveComponent("buche-node");return e.openBlock(),e.createElementBlock("div",ee,[n.node?(e.openBlock(),e.createBlock(m,{key:0,depth:0,index:0,total:1,root:!0,onWant_teleport:s.trigger_teleport,onWant_copy:s.trigger_copy,onTeleport:t[0]||(t[0]=d=>i.root_teleport_candidate=d===i.root_teleport_candidate?null:d),onCopy:t[1]||(t[1]=d=>i.root_copy_candidate=d===i.root_copy_candidate?null:d),blocks:n.blocks,path:[],copy_candidate:i.root_copy_candidate,teleport_candidate:i.root_teleport_candidate,node:n.node,"onUpdate:node":t[2]||(t[2]=d=>o.$emit("update:node",d))},null,8,["onWant_teleport","onWant_copy","blocks","copy_candidate","teleport_candidate","node"])):e.createCommentVNode("",!0)])}var C=k($,[["render",te]]);const ne={type:"generic",label:"Groupe",constructor:()=>({data:{},root:!1,type:"generic",children:[],uuid:N()}),children_min:0,has_children:!0},oe=C;c.Buche=oe,c.default=C,c.generic_block=ne,Object.defineProperty(c,"__esModule",{value:!0}),c[Symbol.toStringTag]="Module"});
